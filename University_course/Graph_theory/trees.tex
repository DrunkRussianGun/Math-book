\section{Деревья}
\index{Лес} Граф без циклов называется \textbf{лесом}.

\index{Дерево} Связный лес называется \textbf{деревом}.

\index{Мост} Ребро называется \textbf{мостом}, если при его удалении увеличивается число компонент связности.

\begin{statement}
\label{st:criterion_of_bridge_in_graph}
Ребро~--- мост $\Leftrightarrow$ оно не содержится в~цикле.
\end{statement}
\begin{proof}
\begin{enumerate}
	\item $\Leftarrow$.
	Пусть ребро $e$ содержится в цикле $W = (v_0, e_0, \ldots, u, e, v, \ldots, v_k)$, $u'$ и $v'$~--- связные вершины.
	\begin{enumerate}
		\item Если в~$(u', v')$-маршруте нет ребра~$e$, то при его удалении из графа $u'$ и $v'$ останутся связными.
		\item Пусть $(u' = v_0', e_0', \ldots, u, e, v, \ldots, e_m', v_m' = v')$~--- маршрут, соединяющий $u'$ и $v'$, тогда при удалении $e$ из графа $u'$ и $v'$ соединяет маршрут\newline
		$(u' = v_0', e_0', \ldots, u, \ldots, e_0, v_0 = v_k, e_{k-1}, \ldots, v, \ldots, e_m', v_m' = v')$.
	\end{enumerate}
	
	\item $\Rightarrow$.
	Пусть $e = \{ u, v \}$ не является мостом, тогда $u$, $v$ лежат в~одной компоненте связности.
	Удалим $e$ из графа.
	Число компонент связности не изменится, значит, $u$ и $v$ также лежат в~одной компоненте связности, т.\,е. существует цепь, соединяющая $u$ и $v$: $(u = v_0; e_0; \ldots; e_{k-1}; v_k = v)$.
	Тогда в~исходном графе существует цикл $(u = v_0, e_0, \ldots, e_{k-1}, v_k = v, e, u)$.
\end{enumerate}
\end{proof}

\begin{theorem}
Следующие утверждения о графе~$G = (V, E)$ с~$n$ вершинами эквивалентны:
\begin{enumerate}[(1)]
	\item $G$~--- дерево.
	\item $G$ связный и каждое его ребро~--- мост.
	\item $G$ связный и имеет $n - 1$~ребро.
	\item $G$ не содержит циклов и имеет $n - 1$~ребро.
	\item Любые две вершины графа~$G$ соединены ровно одной простой цепью.
	\item $G$ не содержит циклов и добавление ребра приводит к появлению ровно одного цикла.
\end{enumerate}
\end{theorem}
\begin{proof}
\begin{itemize}
	\item (1) $\Rightarrow$ (2).
	Связность следует из определения дерева.
	
	В~силу утверждения~\ref*{st:criterion_of_bridge_in_graph} каждое ребро~--- мост.
	
	\item (2) $\Rightarrow$ (3).
	Связность следует из предположения.
	
	Докажем методом математической индукции, что в~графе $n - 1$~ребро.
	\indbase Для $n = 1, 2$ очевидно.
	\indstep Пусть утверждение верно для чисел, меньших $n$.
	Возьмём мост~$e$ и удалим его.
	Получим две компоненты связности $G_1 = (V_1, E_1)$, $G_2 = (V_2, E_2)$.
	По предположению индукции $|E_1| = |V_1| - 1$, $|E_2| = |V_2| - 1$.
	Тогда в~исходном графе рёбер $|E_1| + |E_2| + 1 = |V_1| + |V_2| - 1 = n - 1$. \indend
	
	\item (3) $\Rightarrow$ (4).
	$G$ имеет $n - 1$~ребро по предположению.
	
	Докажем методом математической индукции, что $G$ не содержит циклов.
	\indbase Для $n = 1, 2$ очевидно.
	\indstep Пусть утверждение верно для чисел, меньших $n$.
	Докажем методом от противного, что в~графе есть вершина степени~$1$.
	Пусть
	\begin{equation*}
	\forall u \in V \ \deg u \geqslant 2 \Rightarrow 2|E| = \sum_{u \in V} \deg u \geqslant 2n \Rightarrow n - 1 = |E| \geqslant n \Rightarrow -1 \geqslant 0
	\end{equation*}
	Противоречие, значит, в~графе найдётся вершина степени~$1$.
	
	Удалим её и инцидентное ей ребро.
	Полученный граф содержит $n - 1$~вершину и удовлетворяет утверждению~(3).
	По предположению индукции он не содержит циклов, тогда и исходный граф не содержит циклов. \indend
	
	\item (4) $\Rightarrow$ (5).
	
	Пусть в~графе $k$~компонент связности: $G_1 = (V_1, E_1)$, $G_2 = (V_2, E_2)$, \ldots, $G_k = (V_k, E_k)$.
	Они не содержат циклов по предположению, тогда они являются деревьями.
	\begin{equation*}
	|E_1| = |V_1| - 1, |E_2| = |V_2| - 1, \ldots, |E_k| = |V_k| - 1,
	n - 1 = |E_1| + \ldots + |E_k| = n - k \Rightarrow k = 1
	\end{equation*}
	Значит, граф связный.
	
	Пусть существуют вершины $u$ и $v$ такие, что их соединяют две простые цепи, тогда по лемме~\ref{lemma:existence_of_simple_cycle} в~графе есть цикл, что противоречит предположению.
	Значит, эти вершины соединены ровно одной простой цепью.
	
	\item (5) $\Rightarrow$ (6).
	
	Докажем методом от противного, что в~графе нет циклов.
	Предположим, что есть цикл $(v_0, e_0, v_1, \allowbreak \ldots, \allowbreak v_k = v_0)$, тогда есть две простые цепи $(v_0, e_0, \ldots, v_{k-1})$ и $(v_{k-1}, e_k, v_k = v_0)$, соединяющие $v_0$ и $v_{k-1}$, что противоречит предположению.
	
	Докажем, что добавление ребра приводит к появлению ровно одного цикла.
	Рассмотрим несоседние вершины $u$ и $v$.
	По предположению есть цепь $(u = v_0, e_0, \ldots, v_k = v)$, соединяющая их.
	Тогда, добавив $e = \{ u, v \}$, получим цикл $(u = v_0, e_0, \ldots, v_k = v, e, u)$.
	
	Пусть есть $2$~цикла, соединяющих $u$ и $v$.
	Удалим $e$, тогда один цикл останется.
	Получим исходный граф, в~котором не должно быть циклов.
	Противоречие.
	
	\item (6) $\Rightarrow$ (1).
	
	Докажем связность методом от противного.
	Рассмотрим несвязные вершины $u$ и~$v$.
	Соединим их и по~предположению получим цикл $(v_0, e_0, \ldots, u, e, v, \ldots, e_{k-1}, v_k = v_0)$.
	Тогда в~исходном графе $(u, \ldots, e_0, v_0 = v_k, e_{k-1}, \ldots, v)$~--- $(u, v)$-маршрут.
	Противоречие.
\end{itemize}
\end{proof}

В~ходе доказательства было получено, что в~связном графе с $n$~вершинами и $n - 1$~рёбрами существует висячая вершина.
Т.\,к. доказано, что такой граф является деревом, то верно следующее утверждение.
\begin{statement}
В~дереве существует висячая вершина.
\end{statement}

\begin{statement}
Если в лесу $n$~вершин, $m$~рёбер и $k$~компонент связности, то $m = n - k$.
\end{statement}
\begin{proof}
Пусть $n_1, \ldots, n_k$~--- число вершин в каждой компоненте связности, тогда
\begin{equation*}
m = (n_1 - 1) + (n_2 - 1) + \ldots + (n_k - 1) = n - k
\end{equation*}
\end{proof}